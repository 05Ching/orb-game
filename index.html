<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Space Blaster ‚Äî aurora edition</title>
  <style>
    :root{
      --bg:#05070f; --ink:#eef4ff; --muted:#a9b2c7;
      --a1:#6dd6ff; --a2:#8a7dff; --a3:#ff87d7; --a4:#ffd36e; --danger:#ff6b6b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;display:grid;place-items:center;background:var(--bg);color:var(--ink);font:500 15px/1.5 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans",sans-serif}
    .wrap{width:min(1040px,96vw);padding:16px;border-radius:20px;background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));box-shadow:0 24px 70px rgba(0,0,0,.5),inset 0 0 0 1px rgba(255,255,255,.06);position:relative;overflow:hidden}
    /* animated aurora */
    .wrap::before,.wrap::after{content:"";position:absolute;inset:-20%;filter:blur(60px);opacity:.35;animation:flow 18s linear infinite alternate;pointer-events:none}
    .wrap::before{background:conic-gradient(from 120deg at 30% 20%, var(--a1), transparent 35%, var(--a2), transparent 60%, var(--a3), transparent)}
    .wrap::after{background:radial-gradient(60% 40% at 70% 30%, var(--a4), transparent 60%);animation-duration:22s}
    @keyframes flow{to{transform:translate3d(0,-6%,0) rotate(8deg) scale(1.04)}}

    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:8px;position:relative;z-index:1}
    h1{margin:0;font-size:18px;letter-spacing:.4px;opacity:.92}
    .meta{display:flex;gap:10px;align-items:center;color:var(--muted)}
    .btn{appearance:none;border:0;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:800;letter-spacing:.3px;color:#061019;background:linear-gradient(135deg,var(--a1),var(--a2));box-shadow:0 8px 24px rgba(109,214,255,.32)}
    .btn.alt{background:linear-gradient(135deg,var(--a3),var(--a4));color:#0b0f1a;box-shadow:0 8px 24px rgba(255,135,215,.28)}
    .btn:active{transform:translateY(1px)}

    canvas{width:100%;height:auto;display:block;border-radius:16px;background:linear-gradient(180deg,#040712,#03060e);position:relative;z-index:1}

    .hud{display:flex;flex-wrap:wrap;gap:10px;margin-top:8px;position:relative;z-index:1}
    .chip{padding:6px 12px;border-radius:999px;background:rgba(255,255,255,.07);font-weight:800;backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);box-shadow:inset 0 0 0 1px rgba(255,255,255,.08)}
    .chip .em{margin-right:6px}

    footer{margin-top:8px;color:var(--muted);font-size:13px;position:relative;z-index:1}
    kbd{background:rgba(255,255,255,.08);padding:2px 6px;border-radius:6px;border:1px solid rgba(255,255,255,.1)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>üåå Space Blaster ‚Äî <span style="opacity:.75">aurora edition</span></h1>
      <div class="meta">
        <button id="btnStart" class="btn">Start</button>
        <button id="btnPause" class="btn alt">Pause</button>
      </div>
    </header>

    <canvas id="game" width="960" height="540"></canvas>

    <div class="hud">
      <div class="chip"><span class="em">üèÜ</span>Score: <span id="score">0</span></div>
      <div class="chip"><span class="em">üíô</span>Lives: <span id="lives">3</span></div>
      <div class="chip"><span class="em">üåä</span>Wave: <span id="wave">1</span></div>
      <div class="chip"><span class="em">‚≠ê</span>Best: <span id="best">0</span></div>
    </div>

    <footer>
      Move <kbd>W</kbd><kbd>A</kbd><kbd>S</kbd><kbd>D</kbd> / ‚¨ÖÔ∏è‚¨ÜÔ∏è‚¨áÔ∏è‚û°Ô∏è ‚Ä¢ Shoot <kbd>Space</kbd> / Click ‚Ä¢ <strong>P</strong> Pause ‚Ä¢ <strong>R</strong> Restart ‚Ä¢ Mobile: ÊãñÊõ≥ÁßªÂãï„ÄÅÈªûÊìäÂ∞ÑÊìä
    </footer>
  </div>

<script>
// ‚Äî‚Äî Space Blaster: Aurora Edition (visual polish) ‚Äî‚Äî
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const dpr = Math.max(1, Math.min(2, devicePixelRatio||1));
function fit(){ const r=canvas.getBoundingClientRect(); canvas.width=Math.round(r.width*dpr); canvas.height=Math.round(r.width*9/16*dpr);} fit(); addEventListener('resize',fit);

const scoreEl = document.getElementById('score');
const livesEl = document.getElementById('lives');
const waveEl  = document.getElementById('wave');
const bestEl  = document.getElementById('best');
const btnStart= document.getElementById('btnStart');
const btnPause= document.getElementById('btnPause');

// Tiny WebAudio beeps
const AC = window.AudioContext||window.webkitAudioContext; const actx = new AC();
function beep(type='triangle', f=440, t=0.08, g=0.14){ const o=actx.createOscillator(), v=actx.createGain(); o.type=type; o.frequency.value=f; v.gain.value=g; o.connect(v); v.connect(actx.destination); const now=actx.currentTime; o.start(now); v.gain.exponentialRampToValueAtTime(0.0001, now+t); o.stop(now+t); }

// Utils
const R=(a,b)=>Math.random()*(b-a)+a; const clamp=(x,a,b)=>Math.max(a,Math.min(b,x));

const S={running:false, started:false, score:0, lives:3, wave:1, best:Number(localStorage.getItem('sb_best')||0), time:0, keys:new Set(), ship:{x:220,y:0,r:14,speed:330,cd:0,trail:[]}, shots:[], enemies:[], particles:[], powerups:[]};
S.ship.y = canvas.height - 90*dpr; bestEl.textContent=S.best;

// Controls
addEventListener('keydown',e=>{const k=e.key.toLowerCase(); if(['arrowleft','arrowright','arrowup','arrowdown','a','d','w','s'].includes(k)) S.keys.add(k); if(k===' '){shoot(); e.preventDefault();} if(k==='p') toggle(); if(k==='r') start(true);});
addEventListener('keyup',e=>S.keys.delete(e.key.toLowerCase()));
canvas.addEventListener('pointerdown',e=>{moveTo(e); shoot();}); canvas.addEventListener('pointermove',e=>{if(e.buttons) moveTo(e);});
function moveTo(e){const r=canvas.getBoundingClientRect(); S.ship.x=(e.clientX-r.left)*dpr; S.ship.y=(e.clientY-r.top)*dpr;}
btnStart.onclick=()=>start(!S.started); btnPause.onclick=toggle;

function start(reset=false){ if(reset||!S.started){Object.assign(S,{score:0,lives:3,wave:1,shots:[],enemies:[],particles:[],powerups:[],time:0}); S.started=true;} S.running=true; btnPause.textContent='Pause'; actx.resume(); beep('sawtooth',640,0.08,0.12);}
function toggle(){S.running=!S.running; btnPause.textContent=S.running?'Pause':'Resume'; if(S.running) actx.resume();}

// Entities
function spawnWave(){ const n=6+S.wave*2; for(let i=0;i<n;i++){ const y=R(50*dpr,160*dpr), x=R(50*dpr, canvas.width-50*dpr); const vx=R(-40,40), vy=R(20,60); const spin=R(-2,2); S.enemies.push({x,y,r:16*dpr,hp:1+Math.floor(S.wave/3), vx,vy,spin,a:R(0,Math.PI*2) }); }}
function shoot(){ if(!S.running) return; if(S.ship.cd>0) return; const rt=S.ship.rapid?0.1:0.18; S.ship.cd=rt; const bspd=540; S.shots.push({x:S.ship.x,y:S.ship.y-18*dpr,r:3*dpr,vy:-bspd,player:true}); if(S.wave>=5) S.shots.push({x:S.ship.x+10*dpr,y:S.ship.y-18*dpr,r:3*dpr,vy:-bspd,player:true}); beep('triangle',900,0.05,0.09);}

function explode(x,y,n=22,clr='#8a7dff'){ for(let i=0;i<n;i++){S.particles.push({x,y,vx:R(-220,220),vy:R(-220,220),life:R(.35,.8),r:R(1.5,3)*dpr,c:clr});}}
function drop(x,y){ if(Math.random()<0.18){S.powerups.push({x,y,r:10*dpr,vy:80,kind:Math.random()<0.55?'shield':'rapid'});} }
function hit(a,b){ const dx=a.x-b.x, dy=a.y-b.y; return dx*dx+dy*dy <= (a.r+b.r)*(a.r+b.r); }

// Drawing helpers
function glow(x,y,r,c1,c2){ const g=ctx.createRadialGradient(x,y,r*.1,x,y,r); g.addColorStop(0,c1); g.addColorStop(1,c2); ctx.fillStyle=g; ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill(); }
function text(t,x,y,s=16,align='left',c='#eef4ff'){ ctx.font=`${Math.round(s*dpr)}px ui-sans-serif,system-ui`; ctx.textAlign=align; ctx.fillStyle=c; ctx.fillText(t,x,y); }

// Parallax stars
const stars=Array.from({length:140},()=>({x:Math.random(),y:Math.random(),z:R(.3,1.3)}));
function drawStars(dt){ ctx.save(); for(const s of stars){ s.y+=dt*.025*s.z; if(s.y>1) s.y-=1; const x=s.x*canvas.width, y=s.y*canvas.height; ctx.globalAlpha=.35*s.z; glow(x,y,1.8*dpr,'#cde6ff','transparent'); } ctx.restore(); }

let last=performance.now();
function loop(now){ const dt=Math.min(.033,(now-last)/1000); last=now; ctx.clearRect(0,0,canvas.width,canvas.height); drawStars(dt);
  // subtle neon grid
  ctx.globalAlpha=.12; ctx.strokeStyle='rgba(141,125,255,.45)'; ctx.lineWidth=1*dpr; ctx.beginPath(); for(let x=0;x<canvas.width;x+=44*dpr){ctx.moveTo(x,0);ctx.lineTo(x,canvas.height);} for(let y=0;y<canvas.height;y+=44*dpr){ctx.moveTo(0,y);ctx.lineTo(canvas.width,y);} ctx.stroke(); ctx.globalAlpha=1;

  if(S.running){ S.time+=dt; if(S.enemies.length===0 && S.shots.filter(b=>!b.player).length===0) spawnWave();
    // Ship move + trail
    const p=S.ship, sp=p.speed*dpr*dt; if(S.keys.has('arrowleft')||S.keys.has('a')) p.x-=sp; if(S.keys.has('arrowright')||S.keys.has('d')) p.x+=sp; if(S.keys.has('arrowup')||S.keys.has('w')) p.y-=sp; if(S.keys.has('arrowdown')||S.keys.has('s')) p.y+=sp; p.x=clamp(p.x,20*dpr,canvas.width-20*dpr); p.y=clamp(p.y,40*dpr,canvas.height-20*dpr); if(p.cd>0) p.cd-=dt; p.trail.push({x:p.x,y:p.y+12*dpr,life:.35}); if(p.trail.length>20) p.trail.shift(); }

  // Enemy update/draw (with spin diamond sprite)
  for(const e of S.enemies){ if(S.running){ e.x+=e.vx*dt; e.y+=e.vy*dt*.6; e.a+=e.spin*dt; if(e.x<30*dpr||e.x>canvas.width-30*dpr) e.vx*=-1; if(Math.random()<0.002*S.wave) S.shots.push({x:e.x,y:e.y+14*dpr,r:3*dpr,vy:220,player:false}); }
    ctx.save(); ctx.translate(e.x,e.y); ctx.rotate(e.a); ctx.globalAlpha=.95; // body
    const r=e.r*0.9; const g=ctx.createLinearGradient(-r,-r,r,r); g.addColorStop(0,'#ffc3a1'); g.addColorStop(1,'#ff7a59'); ctx.fillStyle=g; ctx.beginPath(); ctx.moveTo(0,-r); ctx.lineTo(r,0); ctx.lineTo(0,r); ctx.lineTo(-r,0); ctx.closePath(); ctx.fill(); ctx.strokeStyle='rgba(255,205,178,.7)'; ctx.lineWidth=2*dpr; ctx.stroke(); ctx.restore(); }

  // Bullets
  for(const b of S.shots){ if(S.running) b.y+=b.vy*dt; glow(b.x,b.y,b.r, b.player?'#8a7dff':'#ff6b6b','transparent'); }
  S.shots=S.shots.filter(b=>b.y>-20*dpr && b.y<canvas.height+20*dpr);

  // Collisions: player bullets vs enemies
  if(S.running){ for(let i=S.shots.length-1;i>=0;i--){ const b=S.shots[i]; if(!b.player) continue; for(let j=S.enemies.length-1;j>=0;j--){ const e=S.enemies[j]; if(hit(b,{x:e.x,y:e.y,r:e.r*0.95})) { S.shots.splice(i,1); e.hp--; explode(b.x,b.y,12,'#8a7dff'); if(e.hp<=0){ S.enemies.splice(j,1); S.score+=10; if(Math.random()<0.22) drop(e.x,e.y); beep('square',660,0.05,0.12);} break; } } } }

  // Enemy bullets vs player
  if(S.running){ for(let i=S.shots.length-1;i>=0;i--){ const b=S.shots[i]; if(b.player) continue; if(hit(b,{x:S.ship.x,y:S.ship.y,r:S.ship.r*1.1})) { S.shots.splice(i,1); damage(); break; } } }

  // Enemy contact
  if(S.running){ for(let i=S.enemies.length-1;i>=0;i--){ const e=S.enemies[i]; if(hit(e,{x:S.ship.x,y:S.ship.y,r:S.ship.r})) { S.enemies.splice(i,1); explode(e.x,e.y,22,'#ff6b6b'); damage(); } } }

  // Powerups
  for(const p of S.powerups){ if(S.running) p.y+=p.vy*dt; glow(p.x,p.y,p.r, p.kind==='shield'?'#6dd6ff':'#ffd36e','transparent'); if(S.running && hit(p,{x:S.ship.x,y:S.ship.y,r:S.ship.r*1.2})){ if(p.kind==='shield'){ S.ship.shield=(S.ship.shield||0)+2; } else { S.ship.rapid = 1; setTimeout(()=>S.ship.rapid=0, 5000); } explode(p.x,p.y,14, p.kind==='shield'?'#6dd6ff':'#ffd36e'); beep('triangle',520,0.06,0.12); p.dead=true; } }
  S.powerups=S.powerups.filter(p=>!p.dead && p.y<canvas.height+30*dpr);

  // Particles
  for(const p of S.particles){ p.x+=p.vx*dt; p.y+=p.vy*dt; p.life-=dt; ctx.globalAlpha=Math.max(0,p.life); glow(p.x,p.y,p.r,'#d7e8ff','transparent'); } ctx.globalAlpha=1; S.particles=S.particles.filter(p=>p.life>0);

  // Ship trail + ship drawing
  for(const t of S.ship.trail){ t.life-=dt; ctx.globalAlpha=Math.max(0,t.life)*.6; glow(t.x,t.y, 6*dpr,'#6dd6ff','transparent'); } ctx.globalAlpha=1; S.ship.trail=S.ship.trail.filter(t=>t.life>0);
  const sh=S.ship; glow(sh.x,sh.y, sh.r+1.8*dpr,'#b8c7ff','rgba(109,214,255,0)'); ctx.strokeStyle='rgba(109,214,255,.85)'; ctx.lineWidth=2*dpr; ctx.beginPath(); ctx.arc(sh.x,sh.y,sh.r*1.25,0,Math.PI*2); ctx.stroke(); if(sh.shield){ ctx.strokeStyle='rgba(109,214,255,.45)'; ctx.setLineDash([6*dpr,4*dpr]); ctx.beginPath(); ctx.arc(sh.x,sh.y, sh.r*1.85, 0, Math.PI*2); ctx.stroke(); ctx.setLineDash([]); }

  // Wave text
  if(S.running && S.enemies.length===0 && S.shots.filter(b=>!b.player).length===0){ S.wave++; waveEl.textContent=S.wave; text(`Wave ${S.wave}`, canvas.width/2, 64*dpr, 22,'center','#a9b2c7'); }

  // HUD text in-canvas
  text(`Score ${S.score}`, 16*dpr, 26*dpr); text(`Lives ${S.lives}`, 16*dpr, 46*dpr, 16); text(`Wave ${S.wave}`, canvas.width-16*dpr, 26*dpr, 16,'right'); text(`Best ${S.best}`, canvas.width-16*dpr, 46*dpr, 16,'right');

  // DOM HUD sync
  scoreEl.textContent=S.score; livesEl.textContent=S.lives; waveEl.textContent=S.wave; bestEl.textContent=S.best;

  // Overlays
  if(!S.started) drawCenter('Space Blaster', 'Press Start or Space');
  if(S.started && !S.running && S.lives<=0) drawCenter('Game Over', 'Press R to restart');

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

function drawCenter(title, subtitle){ text(title, canvas.width/2, canvas.height/2-10*dpr, 30,'center'); text(subtitle, canvas.width/2, canvas.height/2+24*dpr, 16,'center','#a9b2c7'); }
function damage(){ if(S.ship.shield){ S.ship.shield--; explode(S.ship.x,S.ship.y,16,'#6dd6ff'); beep('sine',300,0.05,0.08); return; } S.lives--; explode(S.ship.x,S.ship.y,34,'#ff6b6b'); beep('sine',200,0.08,0.12); if(S.lives<=0){ S.running=false; btnPause.textContent='Resume'; S.best=Math.max(S.best,S.score); localStorage.setItem('sb_best',String(S.best)); }}
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Space Blaster ‚Äî aurora edition</title>
  <style>
    :root{
      --bg:#05070f; --ink:#eef4ff; --muted:#a9b2c7;
      --a1:#6dd6ff; --a2:#8a7dff; --a3:#ff87d7; --a4:#ffd36e; --danger:#ff6b6b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;display:grid;place-items:center;background:var(--bg);color:var(--ink);font:500 15px/1.5 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans",sans-serif}
    .wrap{width:min(1040px,96vw);padding:16px;border-radius:20px;background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));box-shadow:0 24px 70px rgba(0,0,0,.5),inset 0 0 0 1px rgba(255,255,255,.06);position:relative;overflow:hidden}
    /* animated aurora */
    .wrap::before,.wrap::after{content:"";position:absolute;inset:-20%;filter:blur(60px);opacity:.35;animation:flow 18s linear infinite alternate;pointer-events:none}
    .wrap::before{background:conic-gradient(from 120deg at 30% 20%, var(--a1), transparent 35%, var(--a2), transparent 60%, var(--a3), transparent)}
    .wrap::after{background:radial-gradient(60% 40% at 70% 30%, var(--a4), transparent 60%);animation-duration:22s}
    @keyframes flow{to{transform:translate3d(0,-6%,0) rotate(8deg) scale(1.04)}}

    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:8px;position:relative;z-index:1}
    h1{margin:0;font-size:18px;letter-spacing:.4px;opacity:.92}
    .meta{display:flex;gap:10px;align-items:center;color:var(--muted)}
    .btn{appearance:none;border:0;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:800;letter-spacing:.3px;color:#061019;background:linear-gradient(135deg,var(--a1),var(--a2));box-shadow:0 8px 24px rgba(109,214,255,.32)}
    .btn.alt{background:linear-gradient(135deg,var(--a3),var(--a4));color:#0b0f1a;box-shadow:0 8px 24px rgba(255,135,215,.28)}
    .btn:active{transform:translateY(1px)}

    canvas{width:100%;height:auto;display:block;border-radius:16px;background:linear-gradient(180deg,#040712,#03060e);position:relative;z-index:1}

    .hud{display:flex;flex-wrap:wrap;gap:10px;margin-top:8px;position:relative;z-index:1}
    .chip{padding:6px 12px;border-radius:999px;background:rgba(255,255,255,.07);font-weight:800;backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);box-shadow:inset 0 0 0 1px rgba(255,255,255,.08)}
    .chip .em{margin-right:6px}

    footer{margin-top:8px;color:var(--muted);font-size:13px;position:relative;z-index:1}
    kbd{background:rgba(255,255,255,.08);padding:2px 6px;border-radius:6px;border:1px solid rgba(255,255,255,.1)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>üåå Space Blaster ‚Äî <span style="opacity:.75">aurora edition</span></h1>
      <div class="meta">
        <button id="btnStart" class="btn">Start</button>
        <button id="btnPause" class="btn alt">Pause</button>
      </div>
    </header>

    <canvas id="game" width="960" height="540"></canvas>

    <div class="hud">
      <div class="chip"><span class="em">üèÜ</span>Score: <span id="score">0</span></div>
      <div class="chip"><span class="em">üíô</span>Lives: <span id="lives">3</span></div>
      <div class="chip"><span class="em">üåä</span>Wave: <span id="wave">1</span></div>
      <div class="chip"><span class="em">‚≠ê</span>Best: <span id="best">0</span></div>
    </div>

    <footer>
      Move <kbd>W</kbd><kbd>A</kbd><kbd>S</kbd><kbd>D</kbd> / ‚¨ÖÔ∏è‚¨ÜÔ∏è‚¨áÔ∏è‚û°Ô∏è ‚Ä¢ Shoot <kbd>Space</kbd> / Click ‚Ä¢ <strong>P</strong> Pause ‚Ä¢ <strong>R</strong> Restart ‚Ä¢ Mobile: ÊãñÊõ≥ÁßªÂãï„ÄÅÈªûÊìäÂ∞ÑÊìä
    </footer>
  </div>

<script>
// ‚Äî‚Äî Space Blaster: Aurora Edition (visual polish) ‚Äî‚Äî
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const dpr = Math.max(1, Math.min(2, devicePixelRatio||1));
function fit(){ const r=canvas.getBoundingClientRect(); canvas.width=Math.round(r.width*dpr); canvas.height=Math.round(r.width*9/16*dpr);} fit(); addEventListener('resize',fit);

const scoreEl = document.getElementById('score');
const livesEl = document.getElementById('lives');
const waveEl  = document.getElementById('wave');
const bestEl  = document.getElementById('best');
const btnStart= document.getElementById('btnStart');
const btnPause= document.getElementById('btnPause');

// Tiny WebAudio beeps
const AC = window.AudioContext||window.webkitAudioContext; const actx = new AC();
function beep(type='triangle', f=440, t=0.08, g=0.14){ const o=actx.createOscillator(), v=actx.createGain(); o.type=type; o.frequency.value=f; v.gain.value=g; o.connect(v); v.connect(actx.destination); const now=actx.currentTime; o.start(now); v.gain.exponentialRampToValueAtTime(0.0001, now+t); o.stop(now+t); }

// Utils
const R=(a,b)=>Math.random()*(b-a)+a; const clamp=(x,a,b)=>Math.max(a,Math.min(b,x));

const S={running:false, started:false, score:0, lives:3, wave:1, best:Number(localStorage.getItem('sb_best')||0), time:0, keys:new Set(), ship:{x:220,y:0,r:14,speed:330,cd:0,trail:[]}, shots:[], enemies:[], particles:[], powerups:[]};
S.ship.y = canvas.height - 90*dpr; bestEl.textContent=S.best;

// Controls
addEventListener('keydown',e=>{const k=e.key.toLowerCase(); if(['arrowleft','arrowright','arrowup','arrowdown','a','d','w','s'].includes(k)) S.keys.add(k); if(k===' '){shoot(); e.preventDefault();} if(k==='p') toggle(); if(k==='r') start(true);});
addEventListener('keyup',e=>S.keys.delete(e.key.toLowerCase()));
canvas.addEventListener('pointerdown',e=>{moveTo(e); shoot();}); canvas.addEventListener('pointermove',e=>{if(e.buttons) moveTo(e);});
function moveTo(e){const r=canvas.getBoundingClientRect(); S.ship.x=(e.clientX-r.left)*dpr; S.ship.y=(e.clientY-r.top)*dpr;}
btnStart.onclick=()=>start(!S.started); btnPause.onclick=toggle;

function start(reset=false){ if(reset||!S.started){Object.assign(S,{score:0,lives:3,wave:1,shots:[],enemies:[],particles:[],powerups:[],time:0}); S.started=true;} S.running=true; btnPause.textContent='Pause'; actx.resume(); beep('sawtooth',640,0.08,0.12);}
function toggle(){S.running=!S.running; btnPause.textContent=S.running?'Pause':'Resume'; if(S.running) actx.resume();}

// Entities
function spawnWave(){ const n=6+S.wave*2; for(let i=0;i<n;i++){ const y=R(50*dpr,160*dpr), x=R(50*dpr, canvas.width-50*dpr); const vx=R(-40,40), vy=R(20,60); const spin=R(-2,2); S.enemies.push({x,y,r:16*dpr,hp:1+Math.floor(S.wave/3), vx,vy,spin,a:R(0,Math.PI*2) }); }}
function shoot(){ if(!S.running) return; if(S.ship.cd>0) return; const rt=S.ship.rapid?0.1:0.18; S.ship.cd=rt; const bspd=540; S.shots.push({x:S.ship.x,y:S.ship.y-18*dpr,r:3*dpr,vy:-bspd,player:true}); if(S.wave>=5) S.shots.push({x:S.ship.x+10*dpr,y:S.ship.y-18*dpr,r:3*dpr,vy:-bspd,player:true}); beep('triangle',900,0.05,0.09);}

function explode(x,y,n=22,clr='#8a7dff'){ for(let i=0;i<n;i++){S.particles.push({x,y,vx:R(-220,220),vy:R(-220,220),life:R(.35,.8),r:R(1.5,3)*dpr,c:clr});}}
function drop(x,y){ if(Math.random()<0.18){S.powerups.push({x,y,r:10*dpr,vy:80,kind:Math.random()<0.55?'shield':'rapid'});} }
function hit(a,b){ const dx=a.x-b.x, dy=a.y-b.y; return dx*dx+dy*dy <= (a.r+b.r)*(a.r+b.r); }

// Drawing helpers
function glow(x,y,r,c1,c2){ const g=ctx.createRadialGradient(x,y,r*.1,x,y,r); g.addColorStop(0,c1); g.addColorStop(1,c2); ctx.fillStyle=g; ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill(); }
function text(t,x,y,s=16,align='left',c='#eef4ff'){ ctx.font=`${Math.round(s*dpr)}px ui-sans-serif,system-ui`; ctx.textAlign=align; ctx.fillStyle=c; ctx.fillText(t,x,y); }

// Parallax stars
const stars=Array.from({length:140},()=>({x:Math.random(),y:Math.random(),z:R(.3,1.3)}));
function drawStars(dt){ ctx.save(); for(const s of stars){ s.y+=dt*.025*s.z; if(s.y>1) s.y-=1; const x=s.x*canvas.width, y=s.y*canvas.height; ctx.globalAlpha=.35*s.z; glow(x,y,1.8*dpr,'#cde6ff','transparent'); } ctx.restore(); }

let last=performance.now();
function loop(now){ const dt=Math.min(.033,(now-last)/1000); last=now; ctx.clearRect(0,0,canvas.width,canvas.height); drawStars(dt);
  // subtle neon grid
  ctx.globalAlpha=.12; ctx.strokeStyle='rgba(141,125,255,.45)'; ctx.lineWidth=1*dpr; ctx.beginPath(); for(let x=0;x<canvas.width;x+=44*dpr){ctx.moveTo(x,0);ctx.lineTo(x,canvas.height);} for(let y=0;y<canvas.height;y+=44*dpr){ctx.moveTo(0,y);ctx.lineTo(canvas.width,y);} ctx.stroke(); ctx.globalAlpha=1;

  if(S.running){ S.time+=dt; if(S.enemies.length===0 && S.shots.filter(b=>!b.player).length===0) spawnWave();
    // Ship move + trail
    const p=S.ship, sp=p.speed*dpr*dt; if(S.keys.has('arrowleft')||S.keys.has('a')) p.x-=sp; if(S.keys.has('arrowright')||S.keys.has('d')) p.x+=sp; if(S.keys.has('arrowup')||S.keys.has('w')) p.y-=sp; if(S.keys.has('arrowdown')||S.keys.has('s')) p.y+=sp; p.x=clamp(p.x,20*dpr,canvas.width-20*dpr); p.y=clamp(p.y,40*dpr,canvas.height-20*dpr); if(p.cd>0) p.cd-=dt; p.trail.push({x:p.x,y:p.y+12*dpr,life:.35}); if(p.trail.length>20) p.trail.shift(); }

  // Enemy update/draw (with spin diamond sprite)
  for(const e of S.enemies){ if(S.running){ e.x+=e.vx*dt; e.y+=e.vy*dt*.6; e.a+=e.spin*dt; if(e.x<30*dpr||e.x>canvas.width-30*dpr) e.vx*=-1; if(Math.random()<0.002*S.wave) S.shots.push({x:e.x,y:e.y+14*dpr,r:3*dpr,vy:220,player:false}); }
    ctx.save(); ctx.translate(e.x,e.y); ctx.rotate(e.a); ctx.globalAlpha=.95; // body
    const r=e.r*0.9; const g=ctx.createLinearGradient(-r,-r,r,r); g.addColorStop(0,'#ffc3a1'); g.addColorStop(1,'#ff7a59'); ctx.fillStyle=g; ctx.beginPath(); ctx.moveTo(0,-r); ctx.lineTo(r,0); ctx.lineTo(0,r); ctx.lineTo(-r,0); ctx.closePath(); ctx.fill(); ctx.strokeStyle='rgba(255,205,178,.7)'; ctx.lineWidth=2*dpr; ctx.stroke(); ctx.restore(); }

  // Bullets
  for(const b of S.shots){ if(S.running) b.y+=b.vy*dt; glow(b.x,b.y,b.r, b.player?'#8a7dff':'#ff6b6b','transparent'); }
  S.shots=S.shots.filter(b=>b.y>-20*dpr && b.y<canvas.height+20*dpr);

  // Collisions: player bullets vs enemies
  if(S.running){ for(let i=S.shots.length-1;i>=0;i--){ const b=S.shots[i]; if(!b.player) continue; for(let j=S.enemies.length-1;j>=0;j--){ const e=S.enemies[j]; if(hit(b,{x:e.x,y:e.y,r:e.r*0.95})) { S.shots.splice(i,1); e.hp--; explode(b.x,b.y,12,'#8a7dff'); if(e.hp<=0){ S.enemies.splice(j,1); S.score+=10; if(Math.random()<0.22) drop(e.x,e.y); beep('square',660,0.05,0.12);} break; } } } }

  // Enemy bullets vs player
  if(S.running){ for(let i=S.shots.length-1;i>=0;i--){ const b=S.shots[i]; if(b.player) continue; if(hit(b,{x:S.ship.x,y:S.ship.y,r:S.ship.r*1.1})) { S.shots.splice(i,1); damage(); break; } } }

  // Enemy contact
  if(S.running){ for(let i=S.enemies.length-1;i>=0;i--){ const e=S.enemies[i]; if(hit(e,{x:S.ship.x,y:S.ship.y,r:S.ship.r})) { S.enemies.splice(i,1); explode(e.x,e.y,22,'#ff6b6b'); damage(); } } }

  // Powerups
  for(const p of S.powerups){ if(S.running) p.y+=p.vy*dt; glow(p.x,p.y,p.r, p.kind==='shield'?'#6dd6ff':'#ffd36e','transparent'); if(S.running && hit(p,{x:S.ship.x,y:S.ship.y,r:S.ship.r*1.2})){ if(p.kind==='shield'){ S.ship.shield=(S.ship.shield||0)+2; } else { S.ship.rapid = 1; setTimeout(()=>S.ship.rapid=0, 5000); } explode(p.x,p.y,14, p.kind==='shield'?'#6dd6ff':'#ffd36e'); beep('triangle',520,0.06,0.12); p.dead=true; } }
  S.powerups=S.powerups.filter(p=>!p.dead && p.y<canvas.height+30*dpr);

  // Particles
  for(const p of S.particles){ p.x+=p.vx*dt; p.y+=p.vy*dt; p.life-=dt; ctx.globalAlpha=Math.max(0,p.life); glow(p.x,p.y,p.r,'#d7e8ff','transparent'); } ctx.globalAlpha=1; S.particles=S.particles.filter(p=>p.life>0);

  // Ship trail + ship drawing
  for(const t of S.ship.trail){ t.life-=dt; ctx.globalAlpha=Math.max(0,t.life)*.6; glow(t.x,t.y, 6*dpr,'#6dd6ff','transparent'); } ctx.globalAlpha=1; S.ship.trail=S.ship.trail.filter(t=>t.life>0);
  const sh=S.ship; glow(sh.x,sh.y, sh.r+1.8*dpr,'#b8c7ff','rgba(109,214,255,0)'); ctx.strokeStyle='rgba(109,214,255,.85)'; ctx.lineWidth=2*dpr; ctx.beginPath(); ctx.arc(sh.x,sh.y,sh.r*1.25,0,Math.PI*2); ctx.stroke(); if(sh.shield){ ctx.strokeStyle='rgba(109,214,255,.45)'; ctx.setLineDash([6*dpr,4*dpr]); ctx.beginPath(); ctx.arc(sh.x,sh.y, sh.r*1.85, 0, Math.PI*2); ctx.stroke(); ctx.setLineDash([]); }

  // Wave text
  if(S.running && S.enemies.length===0 && S.shots.filter(b=>!b.player).length===0){ S.wave++; waveEl.textContent=S.wave; text(`Wave ${S.wave}`, canvas.width/2, 64*dpr, 22,'center','#a9b2c7'); }

  // HUD text in-canvas
  text(`Score ${S.score}`, 16*dpr, 26*dpr); text(`Lives ${S.lives}`, 16*dpr, 46*dpr, 16); text(`Wave ${S.wave}`, canvas.width-16*dpr, 26*dpr, 16,'right'); text(`Best ${S.best}`, canvas.width-16*dpr, 46*dpr, 16,'right');

  // DOM HUD sync
  scoreEl.textContent=S.score; livesEl.textContent=S.lives; waveEl.textContent=S.wave; bestEl.textContent=S.best;

  // Overlays
  if(!S.started) drawCenter('Space Blaster', 'Press Start or Space');
  if(S.started && !S.running && S.lives<=0) drawCenter('Game Over', 'Press R to restart');

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

function drawCenter(title, subtitle){ text(title, canvas.width/2, canvas.height/2-10*dpr, 30,'center'); text(subtitle, canvas.width/2, canvas.height/2+24*dpr, 16,'center','#a9b2c7'); }
function damage(){ if(S.ship.shield){ S.ship.shield--; explode(S.ship.x,S.ship.y,16,'#6dd6ff'); beep('sine',300,0.05,0.08); return; } S.lives--; explode(S.ship.x,S.ship.y,34,'#ff6b6b'); beep('sine',200,0.08,0.12); if(S.lives<=0){ S.running=false; btnPause.textContent='Resume'; S.best=Math.max(S.best,S.score); localStorage.setItem('sb_best',String(S.best)); }}
</script>
</body>
</html>

